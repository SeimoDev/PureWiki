name: Build and Deploy to cooku-life.github.io

on:
  push:
    branches:
      - main # Or your default branch that triggers the build

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4 # Checks out the source repository code

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # Specify your desired Node.js version

      - name: Install Dependencies 👨🏻‍💻
        run: npm install # Or use 'yarn install' if you use Yarn

      - name: Setup SSH Agent for Docs Clone
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.ACTIONS_DEPLOY_KEY }} # Ensure this secret has read access to the docs repo

      - name: Clone Docs Repository 📚
        run: |
          # Ensure the parent directory exists if needed, though git clone usually creates the target dir
          # mkdir -p public
          echo "Cloning docs repository..."
          # Use SSH to clone the repository
          git clone --depth 1 git@github.com:cooku-life/docs.git public/docs
          echo "Docs repository cloned successfully."
          ls -la public/docs # Optional: list contents for verification

      - name: Build 🏗️
        run: npm run build # Executes your build script

      - name: Deploy 🚀
        uses: peaceiris/actions-gh-pages@v4
        with:
          # Use a Personal Access Token (PAT)
          personal_token: ${{ secrets.DEPLOY_TOKEN }}
          # Alternatively, use an SSH Deploy Key (more secure, see explanation below)
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}

          # Target repository and branch
          external_repository: cooku-life/cooku-life.github.io
          publish_branch: main

          # Directory to deploy
          publish_dir: ./dist

          # Commit information
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: Deploying build from ${{ github.sha }} # Custom commit message

          # Optional: Clean target branch before deploying (removes old files)
          # keep_files: false
          # Optional: Force push (use with caution, especially on 'main')
          # force_orphan: true 